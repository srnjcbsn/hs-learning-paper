\documentclass[../Master.tex]{subfiles}
\begin{document}
\providecommand{\master}{..}

Formerly we defined binding sets as a theoretical set, however for practical application we require an exact model.

For instance, earlier we made the assumption that ambiguous predicates would always match correctly, to get an idea of this problem
assume we have a precondition \{$p(x,y), p(z,x)$\}, if we designed the bindings as tuples $(p,(1,2),p)$ which is (predicate A, (variable position of A, variable position of B), predicate B).
Then as is evident this model will have two different interpretations either that there are two predicates like in our example or that there is one predicate with two bindings I.E. \{$p(x,x)$\}.
This could be solved by labeling each predicate with a number in no particular order  to indicate the origin predicate, thus $(p,(1,2),p)$ would become  $(p1,(1,2),p2)$ which would remove the dual interpretation.
However this creates a new issue: Since the numbering is non-deterministic another binding set might have used a different numbering for the predicates;
therefore without the assumption that the predicates always correctly match, meaning same numbering, two bindings that was equal could become be unequal. This becomes an issue with set intersection thus requiring us to redefine it.


This section will detail a new model for representing condition effects and bindings in particular, and it will explain how to utilize it for practical application of the theory.

To summarize the our prior model for preconditions and effects we have the four following sets.
\begin{description}
	\item [{Unproven~$B_u$}] The set of all bindings which has
	neither been proven nor disproven.
	\item [{Proven~$B_k$}] The set of all bindings which has been
	proven.
	\item [{Disproven~$B_d$}] Is the set of bindings and predicates which have
	been disproven, it can be derived from $B_d={\left( B_u \cup B_k \right)}^c$.
	\item [{Candidates~$B_c$}] Is a set of bindings where at least one of the bindings is an actual binding.
	This set like for non-conditional actions are used to prove bindings,
	which is accomplished through disproving the other candidates in the set.
\end{description}


	\subsection*{Hypergraph}
	As we have shown we need a model that represent different bindings over any number of predicates.
	Furthermore, it must provide support for multiple of the same predicates.

	For these reason we have designed a model for predicate bindings using hypergraphs;
	in this	model a vertex is a single predicate's variable position.
	For instance, if we modelled the following predicate $p(x,x)$ its vertices would be $p1$ and $p2$ because it contains two variables.
	The variables position is enumerated in sequence $1\ldots |p|$.

	<\texttt{TODO:} introduction to hypergraphs, edges are sets of vertices>

	In hypergraphs edges can be between more than 2 vertices, we use this to our advantage when modelling bindings.
	We can define two kinds of edges: one to combine predicate vertices into a single predicate and one to represent bindings.

	The two kinds of edges are defined as follows:


	\begin{description}
		\item [{Predicate~edge}] As  single predicates are represented as several vertices one for each variable
		it has; a number is used to indicate the order of the variable's
		positions. This number is appended to the label of the vertex. And an edge is used to connect these vertices together into a single predicate.
		We choose to visualize this type of edge with a line.\\
		\begin{tabular}{c  c}

			$p(x, y)$ becomes &
            \raisebox{-.5\height}{\resizebox{0.16\linewidth}{!}{\input{\master/Graphics/predicateEdge.pgf}}}
		\end{tabular}
		\item[{Binding edge}] To represent variables bound together through a common variable (Bindings) we
		choose to visualize this using normal cloud notation around them.\\
		\begin{tabular}{c  c}

			$p(x) \land q(x)$ becomes &
            \raisebox{-.5\height}{\resizebox{0.2\linewidth}{!}{\input{\master/Graphics/bindingEdge.pgf}}}
		\end{tabular}
	\end{description}

    A state can thus be represented as a hypergraph by converting each predicate to a set of vertices as described above, and collecting all vertices stemming from variables with the same name in binding edges. A detailed algorithm for this conversion is given in Section~\ref{sec:Impl:HGConstruction}, and an example is provided below.

% In addition to the above, a hypergraph also contains exactly one predicate edge which is labelled as the effect of the pattern the hypergraph describes (as a conditional effect can only have one effect, see~\ref{rst:ca:no-multiple-effect}).
%
% Note that a predicate edge will always contain a number of vertices equal to the arity of the predicate, while a binding edge can contain any number of vertices. Furthermore, a binding set can contain several vertices describing the same argument place of the same predicate. To discern vertices, we define them as a tuple containing a name denoting the predicate and the argument place it represents (such as $p_3$), as well as a unique identifier. 
%
% \begin{proposition}
%     All vertices in a hypergraph $H$ is member of exactly one predicate edge and one binding edge.
% \end{proposition}

\begin{figure}
    \centering
        \input{\master/Graphics/sokobanHyperGraph.pgf}
        \caption{Sokoban state from Example~\ref{ex:ca:sokoban-hypergraph} represented as a hypergraph. Here, $s = \texttt{sokobanAt}$, $adj = \texttt{hAdj}$ and $at = \texttt{at}$}\label{fig:ca:sokoban-hypergraph}
\end{figure}

\begin{example}\label{ex:ca:sokoban-hypergraph}
	Consider Example~\ref{ex:ca:sokoban-moveleft-action}. In this we had
	\begin{align*}
		\sigma(S_{before}, \delta) =
			\left\{
			\begin{gathered}
				\texttt{adj-h}(x, y), \\
				\texttt{adj-h}(y, z), \\
				\texttt{at}(y), \\
				\texttt{sokobanAt}(z)
			\end{gathered}
			\right\}
	\end{align*}
	When represented as a hypergraph (see \figref{fig:ca:sokoban-hypergraph}),
	we see that each binding is clearly visualized and that two of the same predicate (\texttt{adj-h}) can be in the same graph.
	Also by modelling this as a graph the idea of disproving bindings also
	becomes explicit as it literally means to remove a vertex from a binding edge.
	Furthermore, in this model the notion of disjoint predicates (Restriction~\ref{rst:ca:no-disjuntive-conditionals}) is shown by the vertices not being connected through any type of edge.
\end{example}

Given a state transition $\left( s, a, s' \right)$, and a grounded predicate $p \in \Delta s$ a hypergraph for $s \cup \{p\}$ now describes 

for any grounded predicate $p \in \Delta s$, a hypergraph can be constructed for $s \cup \{ p \}$ with the predicate edge describing $p$ labelled as an effect. 

\end{document}
