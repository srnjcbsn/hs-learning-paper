\documentclass[../Master.tex]{subfiles}
\providecommand{\master}{..}
\begin{document}

\begin{definition}[Redundant preconditions]\label{def:ca:redundantps}
Consider a conditional $C$ of the form

    \begin{equation*}
        \forall x_1, \dots, x_n : [q\left(x_1, \dots, x_{|q|}\right)] \quad when \quad \left[\bigwedge P\right]
    \end{equation*}
    where $P$ is a set of atoms with parameters from $\left\{x_1, \dots, x_n \right\}$.
    A subset $P' \subset P$ is \emph{redundant} if it holds for all states $S$ that $eff (C,S) = eff \left(C',S\right)$, where $C'$ is identical to $C$ with $P'$ removed from $P$.
\end{definition}



\begin{proposition}\label{prop:ca:redundantps}
    A subset $P'$ of the preconditions $P$ of a conditional $C$ is redundant if there exists a mapping $s : \left\{ x_1, \dots, x_n \right\} \rightarrow \left\{ x_1, \dots, x_n \right\}$ where $\left[ x_1 \mapsto x_n, \dots, x_{|q|} \mapsto x_{|q|}\right]$ such that $s \left[P\right] = P \setminus P'$. That is, a mapping that does not change the name of variables appearing in the effect.
\end{proposition}

\begin{proof} 
    Recall that for a conditional to yield an effect $q\left(O_1, \dots O_{|q|}\right)$ (where $\left\{ O_1, \dots, O_{|q|}\right\} \subseteq \mathcal{O}$) in a state $S$, there must exist a mapping $\sigma$ from variables of $C$ to objects in $\mathcal{O}$, such that $\sigma\left[ P \right] \subseteq S$, and $\sigma\left(x_1\right) = O_1, \dots, \sigma\left(x_{|q|}\right) = O_{|q|}$. Let $C$ be a conditional with precondition set $P$, and $C'$ be equal to $C$, except with preconditions $P \setminus P'$. Let $s$ be a renaming function as described in Proposition~\ref{prop:ca:redundantps}.
    \begin{itemize}
        \item Since $s\left[ P \right] \subset P$, it holds that if $\sigma \left[ P \right] \subseteq S$, then $\sigma \left[ s \left[ P \right] \right] \subseteq S$, which implies that $eff(C,S) \subseteq eff(C',S)$.

        \item If $\sigma$ is a mapping such that $\sigma \left[ s \left[ P \right]\right] \subseteq S$, then $\sigma' = \left(\sigma \circ s \right)$ is a mapping such that $\sigma' \left[P\right] \subseteq S$. Therefore, $eff(C', S) \subseteq eff(C', S)$
    \end{itemize}
    From $eff(C, S) \subseteq eff(C',S) \land eff(C',S) \subseteq eff(C, S)$ we have that $eff(C,S) = eff(C',S)$ for all $S$, and $P'$ is therefore a set of redundant preconditions.
\end{proof}

From Proposition~\ref{prop:ca:redundantps} it follows that a precondition $p$ is redundant if another precondition $p'$ with the same name already exists, and if the $i$'th parameter of $p$ is a variable occuring in the effect, then the $i$'th parameter of $p'$ is identical. From this it can be observed that a set of connecting paths correctly removes redundant preconditions: since connecting paths do not mention variable names, a set of preconditions which are identical to another set in $P$ under variable renaming is described by the same path. See Example~\ref{ex:ca:hgma:ex:collapsing} for an illustration.

However, this is not the case for hypergraphs. In this model, redundant preconditions appear as mirrored subgraphs: If a set of preconditions $P_1 \subset P$ is made redundant by another set $P_2 \subset P$, then they both appear as subhypergraphs of the hypergraph of $P$, and have a binding edge in common. Since $P_1$ is equal to $P_2$ under variable renaming, their hypergraphs are isomorphic under vertex identifier renaming. 

However, ismorphic subgraphs are not automatically removed by either hypergraph construction or -merging functions, and must be handled seperately. In fact, the hypergraph merging algorithm can \textit{add} redundancy, as shown in Example~\ref{ex:ca:hgma:ex:collapsing}.

\begin{example}\label{ex:ca:hgma:ex:collapsing}

	Consider an action $a$ applied in state $s_0$, resulting in state $s_1$:
	\begin{equation*}
		s_0 = \left\{ 
			p\left(o_1, o_2\right), p\left(o_1, o_3\right)
		\right\}
	\end{equation*}

	\begin{equation*}
		s_1 = s_0 \cup \left\{
			q\left( o_1 \right)
		\right\}
	\end{equation*}

	Inspecting this state transition will reveal a single pattern $H$ for the effect $q$ (disregarding negative preconditions), visualized in~\figref{fig:ex:ca:hgma:ex:isomorphic}.

    \begin{equation*}
        H = \forall x, y, z : q(x) \quad \textit{when} \quad
            p(x,y) \land p(x,z)
    \end{equation*}

	As the variables $y$ and $z$ are both leaves, and are bound to the effect in the same manner, the subgraphs $p(x,y)$ and $p(x,z)$ are isomorphic, ie.\ identical under identifier renaming. Collapsing the two subgraphs results in the hypergraph $H'$ (visualized in~\figref{fig:ex:ca:hgma:ex:isomorphicReduced}).
	
    \begin{equation*}
        H' = \forall x, y : q(x) \quad \textit{when} \quad p(x,y)
    \end{equation*}

	Notice that $H$ and $H'$ are equally restrictive: If, for a given set of objects $O$, and a state $s$, there exists a substitution $\delta_1 : \left\{x, y, z\right\} \rightarrow O$ such that $\delta\left[p(x,y), p(x,z)\right] \vdash s$, then there also exists a substitution $\delta_1 : \left\{x, y\right\} \rightarrow O$ such that $\delta_2\left[p(x,y)\right] \vdash s$

	\begin{figure}
        \centering
        \hfill
        \begin{subfigure}[b]{0.4\textwidth}
            \centering
            \resizebox{0.7\linewidth}{!}{\input{\master/Graphics/isomorphic.pgf}}
            \caption{Hypergraph $H$ before collapsing}
            \label{fig:ex:ca:hgma:ex:isomorphic}
        \end{subfigure}%
        \hfill%
        \begin{subfigure}[b]{0.4\textwidth}
            \centering
            \resizebox{0.75\linewidth}{!}{\input{\master/Graphics/isomorphicReduced.pgf}}
            \caption{Hypergraph $H$ after collapsing.}
            \label{fig:ex:ca:hgma:ex:isomorphicReduced}
        \end{subfigure}
		\caption{Hyper graphs for example~\ref{fig:ex:ca:hgma:ex:collapsing}}\label{fig:ex:ca:hgma:ex:collapsing}
        \hfill
    \end{figure}
\end{example}



Note that, by Definition~\ref{def:ca:redundantps}, the addition of redundant preconditions to hypergraphs does not yield incorrect knowledge. However, it does decrease effictiveness and efficiency. It decreases \textit{efficiency}, because the hypergraph grows unnecessarily in size and thus is harder to merge. It decreases effectiveness because the ``proven'' preconditions are reduced to candidates more often, and candidate sets grow in size, making them harder to reduce to the singleton set.

\end{document}
